#pragma once
#ifndef PROTOCOL_H
#define PROTOCOL_H

#include <QString>

// ????? ???????
enum MessageType {
    MSG_TEXT = 1,           // ????? ???? ?????
    MSG_COMMAND = 2,        // ??? ???
    MSG_SYSTEM = 3,         // ????? ????
    MSG_FILE = 4,           // ???
    MSG_IMAGE = 5,          // ????
    MSG_JOIN = 6,           // ?????? ?????? ????
    MSG_LEAVE = 7,          // ?????? ??????
    MSG_ERROR = 8,          // ???
    MSG_SUCCESS = 9         // ???? ?????
};

// ????? ??????
enum ServerCommand {
    CMD_GET_USERS = 101,    // ?????? ??? ????? ??????????
    CMD_CHANGE_NAME = 102,  // ????? ?????
    CMD_KICK_USER = 103,    // ??? ??????
    CMD_BROADCAST = 104,    // ?? ?????
    CMD_PRIVATE_MSG = 105   // ????? ????
};

// ???? ???????
struct ChatMessage {
    MessageType type;
    QString sender;
    QString content;
    QString timestamp;
    QString receiver;  // ????????? ??????

    // ????? ??? ????? ??????
    QString serialize() const {
        return QString("%1|%2|%3|%4|%5")
            .arg(type)
            .arg(sender)
            .arg(content)
            .arg(timestamp)
            .arg(receiver);
    }

    // ????? ?? ?????
    static ChatMessage deserialize(const QString& data) {
        QStringList parts = data.split("|");
        ChatMessage msg;
        if (parts.size() >= 5) {
            msg.type = static_cast<MessageType>(parts[0].toInt());
            msg.sender = parts[1];
            msg.content = parts[2];
            msg.timestamp = parts[3];
            msg.receiver = parts[4];
        }
        return msg;
    }
};

// ??????? ???????
struct ConnectionSettings {
    QString serverIP;
    int serverPort;
    QString userName;
    bool autoConnect;
    bool saveLogs;
    QString logFilePath;
};

#endif // PROTOCOL_H